<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>分享二维码</title>
		<script src="../../js/mui.min.js"></script>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<script src="../../Public/js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<style type="text/css">
		body,
		html {
			width: 100%;
			height: 100%;
			background: transparent !important;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		
		.content {
			width: 13rem;
			height: 14.5rem;
			background: #fff;
			border-radius: 1rem;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			z-index: 9999;
		}
	</style>

	<body>
		<div class="content">
			<img style='width:10rem' src="../../Public/image/qrcode_img.jpg" />
		</div>
	</body>

	<script type="text/javascript">
		//		mui.previewImage();
		var bod = document.querySelector("body");
		bod.addEventListener("tap", back, false)

		function back() {
			var sourcePage = plus.webview.getWebviewById("html/user/me.html");
			if(sourcePage) {
				sourcePage.evalJS("closeMaskShare()");
			}
		}



		mui.plusReady(function() {
			var content = document.querySelector(".content")
			content.addEventListener("tap", saveImg, false)
			//下载图片
			function saveImg(e) {
				e.stopPropagation()
				var picurl = "https://admin.oneyouxi.com.cn/www/upload/qrcode/qrcode_img.jpg"
				var picname;
				var btnArray = ['否', '是'];
				mui.confirm('是否保存该图片？', 'ONE', btnArray, function(e) {
					if(e.index == 1) {

						if(picurl.indexOf("/") > 0) //如果包含有"/"号 从最后一个"/"号+1的位置开始截取字符串
						{
							picname = picurl.substring(picurl.lastIndexOf("/") + 1, picurl.length);
						} else {
							picname = picurl;
						}
						savePicture(picurl, picname)
					}
				});

			}

			function savePicture(picurl, picname){
				// 创建下载任务
				var dtask = plus.downloader.createDownload(picurl, {}, function(d, status) {
					// 下载完成
					if(status == 200) {
						plus.gallery.save(d.filename, function() {
							mui.toast('保存成功');
						}, function() {
							mui.toast('保存失败，请重试！');
						});
					} else {
						alert("Download failed: " + status);
					}

				});
				dtask.start();

			}

		})
	</script>

</html>